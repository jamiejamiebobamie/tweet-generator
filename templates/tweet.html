<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Dead-Writer Tweets</title>

    <!-- <link href="https://fonts.googleapis.com/css?family=Oswald:200,300,400|Roboto:100,200,300,400" rel="stylesheet"> -->

    <!-- Link in our stylesheet -->
    <link re="stylesheet" type="text/css" href=".../static/tweet.css">
    <!-- Make sure this is inside of our <head> -->

    <style>

    .dynamic, .static {
        width: 50px;
        height: 50px;
        position: absolute;
        top: 0;
    }

    .dynamic{
        z-index: 1
    }

    .buttons{
        background: orange;
        /* background: transparent; */
        /* border: none !important; */
        font-size:0;
        z-index:2;
        float:left;
        animation: pulse 5s infinite;
        position: absolute;
        bottom: 15px;
        left:13%;
        margin-left:-150px;
        opacity: 0.2;
        font-size: 30px;
        -webkit-transition-duration: 0.4s; /* Safari */
        transition-duration: 0.4s;
    }


.buttons:hover {
    opacity: 1;
}

    body {background-color: black;}

    h1 {
        animation: pulse 5s infinite;
        color: orange;
        position: absolute;
        z-index: 10;
        font-family: monospace;
        size: 10px;
        opacity: 0.9;
    }

    </style>

  </head>

 <body bgcolor="#E6E6FA">

<div class="buttons">
<input id="Grimm" type="button" value="The Brothers Grimm" onclick="myFunction()">
<input id="Poe" type="button" value="Edgar Allan Poe" >
<input id="Wilde" type="button" value="Oscar Wilde" >
<input id="Woolf" type="button" value="Virginia Woolf" >
<input id="Carroll" type="button" value="Lewis Carroll" >
<input id="Shakespeare" type="button" value="William Shakespeare" >
<input id="Lovecraft" type="button" value="HP Lovecraft" >
<input id="Tweet" type="button" value="Tweet" >
<input id="Keep" type="button" value="Keep" >
</div>

<h1 id="title">helo hllo</h1>

<div class="dynamic">
<video autoplay muted loop id="myVideo">
  <source src="../finals/1door-closed-A.mp4" type="video/mp4">
</video>
</div>

<div class="static">
<video autoplay muted loop id="myVideo-background">
  <source src="../finals/1door-closed-A.mp4" type="video/mp4">
</video>
</div>

<script>

var video = document.getElementById("myVideo");
video.playbackRate = 1;

const button_1 = document.getElementById("Grimm");
const button_2 = document.getElementById("Poe");
const button_3 = document.getElementById("Wilde");
const button_4 = document.getElementById("Woolf");
const button_5 = document.getElementById("Carroll");
const button_6 = document.getElementById("Shakespeare");
const button_7 = document.getElementById("Lovecraft");
const button_8 = document.getElementById("Tweet");
const button_9 = document.getElementById("Keep");
var titleElement = document.getElementById('title');
var open = false;
var tweet;

var clip = "../finals/5door-closed-C.mp4";
const clips = ["../finals/jar1-final.mp4", "../finals/jar2-final-C.mp4", "../finals/jar3-final-D.mp4", "../finals/jar4-final-F.mp4", "../finals/jar5-final-F.mp4", "../finals/jar6-final-B.mp4", "../finals/jar7-final-B.mp4", "../finals/2door-opening.mp4", "../finals/3door open.mp4", "../finals/4door-closing.mp4", "../finals/1door-closed-A.mp4"]

//
var fs = require("fs");


function chooseRandomFile(){
    var files = ["Wilde.md", "Shakespeare.md", "Grimm.md", "Carroll.md", "Lovecraft.md", "Woolf.md", "Shelley.md", "Poe.md"];
    return files[Math.floor(Math.random() * Math.floor(files.length))];
}

function fileToArray(file){
    var text = fs.readFileSync(file).toString('utf-8');
    var words = text.split(" ")
    return words
}

 function arrayToString(array){
     var string = ""
     var i;
     for (i = 0; i < array.length; i++) {
         string += array[i].toString('utf-8') + " "}
     return string;
}

function wordBeforeAfter(array) {
   // """takes in an array of strings,
   // using the global variables word and n,
   // looks for instances of the word in the array.
   // if an instance of the word is found,
   // compiles an array of n words that come before the word.
   // returns an array of tuples of
   // (1) instance of word,
   // (2) array of n words before the instance of the searched word, and
   // (3) the next word that comes after the instance of the searched word."""

   var instances = []
   for (var i = 0; i < array.length; i++) {
       if (array[i] == word){
           var x = i - 1;
           var beforeWords = [];
           while (x > i - n) {
            beforeWords.push(array[x]);
                x -= 1;
                }
                var myInstance = [word, beforeWords, array[i+1]];
                instances.push(myInstance)
                }
             }
             return instances
           }

function nextWords(instances) {
    var lenInt = 0
    var next = {};
    for (var i = 0; i < instances.length; i++) {
        if (instances[i][2] in next) {
            next[instances[i][2]] += 1;
        } else {
            next[instances[i][2]] = 1
        }
        if (lenInt < next[instances[i][2]]){
            lenInt = next[instances[i][2]]
        };
    }
    return ([next, lenInt])
};

function pickRand(nexts){
    var rand = Math.floor(Math.random() * Math.floor(nexts[1]));
    if (rand != 0){
        return rand;
    } else {
        return 1;
    }
}


function valuestoKeys(nexts){
    var max = nexts[1];
    var newDict = {}
    var arrKeys = Object.keys(nexts[0])
    var arrValues = Object.values(nexts[0])
    for (var i = 0; i < arrValues.length; i++){
        if (arrValues[i] in newDict) {
        newDict[arrValues[i]].push(arrKeys[i]);
    } else {
        newDict[arrValues[i]] = [arrKeys[i]]
    }
    }
    return newDict
}


var n = 6;
 var file = chooseRandomFile();
// var file = "test.md"
// var file = "test.md"
var fileArray = fileToArray(file);
// var word = "hippos"
var word = fileArray[Math.floor(Math.random() * Math.floor(fileArray.length))]
var wBA = wordBeforeAfter(fileArray);
var nexts = nextWords(wBA);
var max = nexts[1]
var vTK = valuestoKeys(nexts);

// console.log(nexts);
console.log(file);
// console.log(word);
// console.log(vTK);
var keysvTK = Object.keys(vTK)
// console.log(keysvTK)
var v = Math.floor(Math.random() * Math.floor(keysvTK.length));
// console.log("random index v: " + v)
// var rand_v = (Math.floor(Math.random() * (max - v +1)) + v)
// console.log("random index _v: " + rand_v) //index to pull from
// console.log("value: " + keysvTK[v]) //
// console.log(vTK[keysvTK[v]][0]) // first word
// console.log(vTK[keysvTK[v]][Math.floor(Math.random() * Math.floor(vTK[keysvTK[v]].length - 1))]) // random word
// console.log(Math.floor(Math.random() * Math.floor(vTK[keysvTK[v]].length - 1)))

var tweet = word + " "

while (tweet.length < 140) {
    var wBA = wordBeforeAfter(fileArray);
    var nexts = nextWords(wBA);
    var max = nexts[1]
    var vTK = valuestoKeys(nexts);
    var keysvTK = Object.keys(vTK)
    var v = Math.floor(Math.random() * Math.floor(keysvTK.length));
    word = vTK[keysvTK[v]][Math.floor(Math.random() * Math.floor(vTK[keysvTK[v]].length - 1))]
    tweet = tweet + word + " "
}
tweet = tweet + "-" + file
console.log(tweet)

//Math.floor(Math.random() * (max - min + 1)) + min;


// console.log(Object.keys(vTK)[Math.floor(Math.random() * Math.floor(vTK.length))])

// var rand = pickRand(nexts)

// console.log(rand);
// console.log(max);

//console.log(Math.floor((rand/max) * 100));
// random number between 1 and the max int key value
//divided by the max key value, multiplied by 100 and floored.

//any number equal to or above the number must be put into an array and selected at random.
//words with higher frequencies will always be included in the array.


// Math.floor(Math.random() * Math.floor(fileArr.length)


// console.log(pickRand(nexts));


    // for i, fileWord in enumerate(array):
        // if fileWord == str.lower(str(word)):
            // x = i -1
            // beforeWords = []
            // #while x > (i - int(n) - 1): #if you want n words before word
            // while x > (i - int(n)): #if you want n words after next-word
                // beforeWords.append(array[x])
                // x -= 1
            // myTuple = (word, beforeWords, array[i+1])
            // instances.append(myTuple)
    // return instances
//
// function firstOrderMarkov(arrayOfTuples):
    // """takes in an array of tuples of (word, [array of words before word], next word that comes after word)
    // creates a dictionary of {next word : number of instances}. splits the dictionary into a 'twin index' of two arrays: keys and values.
//
    // "twin index" = keys[0] and values[0] reference the key and value pair of the dictionary that was 'split'.
//
    // for each key the function prints to console what the likelihood is of that key appearing as the next word."""
    // myDict = {}
    // for i, instance in enumerate(arrayOfTuples):
        // if instance[2] not in myDict:
            // myDict[arrayOfTuples[i][2]] = 1
        // else:
            // myDict[arrayOfTuples[i][2]] += 1
    // keys = list(myDict.keys())
    // values = list(myDict.values())
    // print(keys)
    // print(values)
//
// function nOrderMarkov(instances):
    // """takes in an array of tuples (word, [array of n words before word], and next word),
    // cycles through the array of tuples and appends the next word and the word to an array,
    // and then appends the array of before words
//
    // NEED TO EDIT DOCSTRING..."""
    // arrayofArrays = []
    // myDict = {}
    // for i, instance in enumerate(instances):
        // myArray = [] #array in "backwards" chronological order from last word (next) to first word
        // myArray.append(instance[2]) #next word
        // myArray.append(instance[0]) #word
        // myArray+=instance[1] #array of words before word
        // arrayofArrays.append(myArray)
    // for array in arrayofArrays:
        // if tuple(array) not in myDict:
            // myDict[tuple(array)] = 1
        // else:
            // myDict[tuple(array)] += 1
    // keys = list(myDict.keys())
    // values = list(myDict.values())
    // return(keys, values)
//
// function checkChars(myTweet):
    // """checks to see how many characters there are in myTweet. if there are less
    // than 140 then it returns True."""
    // punctuation = [".", "!" , "?"]
    // counter = 0
    // period = False
    // for chars in myTweet:
        // counter += 1
        // if counter > 140 and chars in punctuation:
            // period = True
        // elif counter > 300:
            // period = True
    // if period == False:
        // return True
    // else:
        // return False
    // #and chars in punctuation:
        // #    period = True
    // #if period == True:
    // #    return True
    // #else:
//
// n = 6
// file = "Grimm.md"
// words = arrayFileWords(file)
// word = arrayFileWords(file)[random.randint(0, len(words)-1)]
// myTweet = str(word)
// upperRange = int(n)                          #creates variety
// lowerRange = (int(n) - (int(n)//1.5))        #consider changing
// if lowerRange < 1:
    // lowerRange = 1
// exception = True
// keysValues = nOrderMarkov(wordBeforeAfter(strip_Punc(arrayFileWords(file))))
// while checkChars(myTweet) and exception:
    // try:
//
        // #arrayWords = arrayFileWords(file)
        // #propers = lookForProper(arrayWords)
        // #keysValues = nOrderMarkov(wordBeforeAfter(strip_Punc(lowercase_Array(arrayWords))))
        // x = 0
        // storeIndex = []
        // for i, value in enumerate(keysValues[1]):
            // if value > x:                         #right now it is just going to the highest frequency word, use herd_immunity virus_repro-style
                // x = value
                // storeIndex.append(i)
                // word = keysValues[0][storeIndex[random.randint(((len(storeIndex)-1)//2), (len(storeIndex)-1))]][0]       #i could check to see if the word is in the sentence, would completely get rid of repeats tho...
                // n = random.randint(lowerRange, upperRange)#i could check to see if the chars in the word match the up with the last 20 chars, if so use next most frequent word
                // #print(len(storeIndex))
                // myTweet += str(n)                            #maybe use a queue to do first in, first out of words or chars to consistently check; repetition of the same word is killing me
                // myTweet += " "
                // myTweet += word
                // checkChars(myTweet)
    // except:
        // exception = False
// else:
    // print(arrayToString(uppercaseWords(myTweet)))
    // print(lowerRange)
    // print(upperRange)

//

button_1.addEventListener('click', function(e){
    //num = Math.floor(Math.random() * Math.floor(clips.length))
//    titleElement.innerHTML = "grimm";
    video.setAttribute("src", clips[0]);
    video.load();
    video.playbackRate = 1.2;
    video.loop = false;
    titleElement.innerHTML = tweet;
})

button_2.addEventListener('click', function(e){
    //num = Math.floor(Math.random() * Math.floor(clips.length))

    video.setAttribute("src", clips[1]);
    //video.load();
    video.playbackRate = 1.7;
    video.loop = false;
    titleElement.innerHTML = 'pee';
})

button_3.addEventListener('click', function(e){
    //num = Math.floor(Math.random() * Math.floor(clips.length))
    video.setAttribute("src", clips[2]);
    video.load();
    video.playbackRate = 1.5;
    video.loop = false;
})

button_4.addEventListener('click', function(e){
    //num = Math.floor(Math.random() * Math.floor(clips.length))
    video.setAttribute("src", clips[3]);
    video.load();
    video.playbackRate = 1.5;
    video.loop = false;
})

button_5.addEventListener('click', function(e){
    //num = Math.floor(Math.random() * Math.floor(clips.length))
    video.setAttribute("src", clips[4]);
    video.load();
    video.playbackRate = 1.5;
    video.loop = false;
})

button_6.addEventListener('click', function(e){
    //num = Math.floor(Math.random() * Math.floor(clips.length))
    video.setAttribute("src", clips[5]);
    video.load();
    video.playbackRate = 1.4;
    video.loop = false;
})

button_7.addEventListener('click', function(e){
    //num = Math.floor(Math.random() * Math.floor(clips.length))
    video.setAttribute("src", clips[6]);
    video.load();
    video.playbackRate = 1.7;
    video.loop = false;
})

button_8.addEventListener('click', function(e){
    //num = Math.floor(Math.random() * Math.floor(clips.length))
    video.setAttribute("src", clips[7]);
    video.load();
    video.playbackRate = 1;
    video.loop = false;
    open = true;
})

button_9.addEventListener('click', function(e){
    //num = Math.floor(Math.random() * Math.floor(clips.length))
    video.setAttribute("src", clips[9]);
    video.load();
    video.playbackRate = 1;
    video.loop = false;
    open = false;
})

video.onended = function(e) {
    if (open == false) {
    video.setAttribute("src", clips[10]);
    video.load();
    video.playbackRate = 1.7;
    video.loop = true;
} else {
    video.setAttribute("src", clips[8]);
    video.load();
    video.playbackRate = 1.7;
    video.loop = true;
}
    };

</script>

<script src="tweet.js"></script>

<a href='linkhref.html' id='mylink'>click me</a>

<script type="text/javascript">

var myLink = document.getElementById('Grimm');

Grimm.onclick = function(){

    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "../tweet.js.";
    document.getElementsByTagName("head")[0].appendChild(script);
    return false;

}


</script>

</body>
</html>
